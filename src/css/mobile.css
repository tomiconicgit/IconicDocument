/* ============================================
   Mobile Optimizations
   Touch-first, iOS Safari specific
   ============================================ */

/* iOS Safe Areas */
@supports (padding-top: env(safe-area-inset-top)) {
    .top-bar {
        padding-top: calc(env(safe-area-inset-top) + var(--spacing-md));
    }
    
    .side-panel {
        padding-top: env(safe-area-inset-top);
    }
    
    .aircraft-card {
        bottom: calc(env(safe-area-inset-bottom) + var(--spacing-lg));
    }
}

/* Mobile Breakpoint */
@media (max-width: 768px) {
    
    /* Top Bar Adjustments */
    .top-bar {
        padding: var(--spacing-sm) var(--spacing-md);
    }
    
    .logo-text {
        font-size: 1rem;
    }
    
    .header-stats {
        gap: var(--spacing-md);
    }
    
    .stat-item {
        min-width: 50px;
    }
    
    .stat-value {
        font-size: 1.25rem;
    }
    
    .stat-label {
        font-size: 0.6875rem;
    }
    
    /* Side Panel Full Width */
    .side-panel {
        max-width: 100%;
        border-left: none;
    }
    
    /* Aircraft Card Full Width */
    .aircraft-card {
        left: var(--spacing-md);
        right: var(--spacing-md);
        max-width: none;
    }
    
    .card-title {
        font-size: 1.25rem;
    }
    
    .card-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
    }
    
    .card-value {
        font-size: 1.125rem;
    }
    
    /* Toast Positioning */
    .toast-container {
        top: auto;
        bottom: calc(env(safe-area-inset-bottom, 0px) + var(--spacing-lg));
        left: var(--spacing-md);
        right: var(--spacing-md);
    }
    
    .toast {
        min-width: auto;
        width: 100%;
    }
    
    /* Region Buttons */
    .region-buttons {
        grid-template-columns: 1fr;
    }
}

/* Small Mobile Devices */
@media (max-width: 375px) {
    :root {
        --spacing-lg: 1rem;
        --spacing-xl: 1.5rem;
    }
    
    .logo-text {
        display: none;
    }
    
    .header-stats {
        gap: var(--spacing-sm);
    }
    
    .stat-item {
        min-width: 45px;
    }
    
    .card-grid {
        gap: var(--spacing-xs);
    }
}

/* Landscape Mode */
@media (max-height: 500px) and (orientation: landscape) {
    .top-bar {
        padding: var(--spacing-sm);
    }
    
    .aircraft-card {
        bottom: var(--spacing-sm);
        left: var(--spacing-sm);
        right: auto;
        max-width: 320px;
    }
    
    .panel-content {
        padding: var(--spacing-md);
    }
}

/* Touch Optimization */
@media (hover: none) and (pointer: coarse) {
    /* Larger touch targets */
    button,
    .filter-toggle,
    .region-button,
    .time-button {
        min-height: 44px;
    }
    
    /* Remove hover states */
    .menu-button:hover,
    .panel-close:hover,
    .search-clear:hover,
    .region-button:hover,
    .card-close:hover,
    .card-action:hover {
        background: inherit;
        color: inherit;
        border-color: inherit;
        transform: none;
    }
    
    /* Active states for touch feedback */
    button:active,
    .filter-toggle:active,
    .region-button:active,
    .time-button:active {
        opacity: 0.8;
    }
}

/* High DPI Screens */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .logo-icon,
    .radar-pulse {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
}

/* Dark Mode Enforcement */
@media (prefers-color-scheme: dark) {
    /* Already dark by default, but ensure consistency */
    html {
        color-scheme: dark;
    }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .radar-pulse,
    .live-indicator {
        animation: none !important;
    }
}

/* iOS Specific Fixes */
@supports (-webkit-touch-callout: none) {
    /* Prevent iOS text selection on long press */
    body {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
    }
    
    /* Allow text selection in inputs */
    input,
    textarea {
        -webkit-user-select: auto;
    }
    
    /* Fix for iOS Safari bottom bar */
    .app-container {
        min-height: -webkit-fill-available;
    }
    
    /* Smooth scrolling */
    .panel-content {
        -webkit-overflow-scrolling: touch;
    }
    
    /* Fix for iOS zoom on input focus */
    input,
    select,
    textarea {
        font-size: 16px !important;
    }
}

/* PWA Display Mode */
@media (display-mode: standalone) {
    /* Full screen PWA adjustments */
    .top-bar {
        padding-top: calc(var(--spacing-md) + env(safe-area-inset-top));
    }
}

/* Performance: Will-change hints for animated elements */
.side-panel,
.aircraft-card,
.toast,
.loading-screen {
    will-change: transform;
}

.menu-button.active .hamburger-line,
.toggle-indicator::before {
    will-change: transform;
}

/* Prevent overscroll bounce on iOS */
.panel-content,
.map-container {
    overscroll-behavior: contain;
}

/* Ensure tap targets are large enough */
a,
button,
input,
select,
textarea,
.filter-toggle,
.region-button {
    min-width: 44px;
    min-height: 44px;
}

/* Focus visible for accessibility */
:focus-visible {
    outline: 2px solid var(--color-accent-primary);
    outline-offset: 2px;
}

/* Remove focus outline for mouse users */
:focus:not(:focus-visible) {
    outline: none;
}